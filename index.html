<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="js/phaser.js"></script>
    </head>
    <body>

    <script type="text/javascript">
    window.onload = function() {

        game = new Phaser.Game(1280, 1040, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });
        var platforms;
        var cursors;
        var p1;
        var p2;

        var p1_left;
        var p1_right;
        var p1_punch;
        var p1_kick;
        var p1_block;

        var p2_left;
        var p2_right;
        var p2_punch;

        function Player(game, x, y)
        {
            this.x = x;
            this.y = y;
            this.bodyOffset = {
                x: 40,
                y: 100
            };
            this.lHandOffset = {
                x: -25,
                y: 110,
                punchX: -75,
                punchY: 110
            };
            this.rHandOffset = {
                x: 75,
                y: 110,
                punchX: 125,
                punchY: 110
            }
            this.lFootOffset = {
                x: -30,
                y: 310
            };
            this.rFootOffset = {
                x: 80,
                y: 310
            }


            this.head = game.add.sprite(x,y, 'head');

            this.body = game.add.sprite(x + this.bodyOffset.x, y + this.bodyOffset.y, 'body');

            this.lHand = game.add.sprite(x + this.lHandOffset.x, y + this.lHandOffset.y, 'handfoot');
            this.rHand = game.add.sprite(x + this.rHandOffset.x, y + this.rHandOffset.y, 'handfoot');

            this.lFoot = game.add.sprite(x + this.lFootOffset.x, y + this.lFootOffset.y, 'handfoot');
            this.rFoot = game.add.sprite(x + this.rFootOffset.x, y + this.rFootOffset.y, 'handfoot');

            this.lHand.punching = false;
            this.rHand.punching = false;

            this.lFoot.kicking = false;
            this.rFoot.kicking = false;
        };

        Player.prototype = {
            update: function () {
                this.head.x = this.x;
                this.head.y = this.y;

                this.body.x = this.x + this.bodyOffset.x;
                this.body.y = this.y + this.bodyOffset.y;

                if (this.lHand.punching) {
                    this.lHand.x = this.x + this.lHandOffset.punchX;
                    this.lHand.y = this.y + this.lHandOffset.punchY;
                }
                else
                {
                    this.lHand.x = this.x + this.lHandOffset.x;
                    this.lHand.y = this.y + this.lHandOffset.y;
                }
                this.lHand.punching = false;

                if (this.rHand.punching) {
                    this.rHand.x = this.x + this.rHandOffset.punchX;
                    this.rHand.y = this.y + this.rHandOffset.punchY;
                }
                else
                {
                    this.rHand.x = this.x + this.rHandOffset.x;
                    this.rHand.y = this.y + this.rHandOffset.y;
                }
                this.rHand.punching = false;

                this.lFoot.x = this.x + this.lFootOffset.x;
                this.lFoot.y = this.y + this.lFootOffset.y;

                this.rFoot.x = this.x + this.rFootOffset.x;
                this.rFoot.y = this.y + this.rFootOffset.y;

            },
            moveLeft: function () {
                this.x -= 2;
            },
            moveRight: function () {
                this.x += 2;
            },
            punch: function (hand) {
                if (hand == 'right')
                {
                    this.rHand.punching = true;
                }
                else 
                {
                    this.lHand.punching = true;
                }
            },

            pBody: function ()
            {
                console.log("HIT TO BODY");
            }
        };
        
        function preload() {
            game.load.image('head', 'assets/head.png');
            game.load.image('handfoot', 'assets/handfoot.png');
            game.load.image('body', 'assets/body.png');
            game.load.image('ground', 'assets/platform.png');
        }

        function create() {
            game.physics.startSystem(Phaser.Physics.ARCADE);

            p1_left = game.input.keyboard.addKey(Phaser.Keyboard.A);
            p1_right = game.input.keyboard.addKey(Phaser.Keyboard.D);
            p1_punch = game.input.keyboard.addKey(Phaser.Keyboard.R);
            p1_kick = game.input.keyboard.addKey(Phaser.Keyboard.F);
            p1_block = game.input.keyboard.addKey(Phaser.Keyboard.Q);

            p2_left = game.input.keyboard.addKey(100);
            p2_right = game.input.keyboard.addKey(102);
            p2_punch = game.input.keyboard.addKey(103);

            p1 = new Player(game, 100, 300);
            p2 = new Player(game, 700, 300);
        }

        function update() {

            // Controls go here!
            if (p1_left.isDown)
            {
                p1.moveLeft();
            }
            if (p1_right.isDown)
            {
                p1.moveRight();
            }
            if (p1_punch.isDown)
            {
                p1.punch('right');
                if (p1.rHand.overlap(p2.body))
                    {
                        p1.pBody();
                    }
            }

            if (p2_left.isDown)
            {
                p2.moveLeft();
            }
            if (p2_right.isDown)
            {
                p2.moveRight();
            }

            if (p2_punch.isDown)
            {
                p2.punch('left');
                if (p2.lHand.overlap(p1.body))
                    {
                        p2.pBody();
                    }
            }

            p1.update();
            p2.update();
            
            game.stage.backgroundColor = '#2d2d2d';

            game.physics.arcade.collide(p1.body, p2.body, bodyTouch, null, this);
        }

        function render() {
            game.debug.bodyInfo(p1.rHand, 16, 24);
        }

        function bodyTouch(obj1, obj2)
        {
            game.stage.backgroundColor = '#992d2d';
            console.log("HIT!");
        }

    };

    </script>

    </body>
</html>